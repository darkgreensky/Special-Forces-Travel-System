import React, { Component } from 'react';
import earth from '../../../images/earth.png';
import mapimg from '../../../images/map.png';

class Measure extends Component {
    constructor(props) {
        super(props);
        this.state = {
            map: null,
            defaultLayer: null,
            satelliteLayer: null,
            mouseTool: null,
            overlays: [],
        };
    }

    componentDidMount() {
        let AMap = window.AMap;
        let defaultLayer = new AMap.TileLayer(); //高德默认标准图层
        this.map = new AMap.Map('amap', {
            zoom:11,//级别
            center: [118.796877, 32.060255],//中心点坐标
            viewMode:'3D',//使用3D视图
            layers: [//使用多个图层
                defaultLayer
            ],
            zooms: [4,18],//设置地图级别范围
        });

        this.mouseTool = new AMap.MouseTool(this.map);
        //监听draw事件可获取画好的覆盖物
        // this.mouseTool.on('draw',function(e){
        //     this.state.overlays.push(e.obj);
        // })
        this.mouseTool.on('draw', (e) => {
            this.setState(prevState => ({
                overlays: [...prevState.overlays, e.obj]
            }));
        });

        this.setState({ map: this.map, defaultLayer: defaultLayer, mouseTool: this.mouseTool});

    }

    draw(type)  {
        switch(type){
            case 'measureArea': {
                this.state.mouseTool.measureArea({
                    strokeColor:'#80d8ff',
                    fillColor:'#80d8ff',
                    fillOpacity:0.3
                    //同 Polygon 的 Option 设置
                });
                break;
            }
            case 'rule': {
                let AMap = window.AMap;
                this.state.mouseTool.rule({
                    startMarkerOptions : {//可缺省
                        icon: new AMap.Icon({
                            size: new AMap.Size(19, 31),//图标大小
                            imageSize:new AMap.Size(19, 31),
                            image: "//webapi.amap.com/theme/v1.3/markers/b/start.png"
                        }),
                        offset: new AMap.Pixel(-9, -31)
                    },
                    endMarkerOptions : {//可缺省
                        icon: new AMap.Icon({
                            size: new AMap.Size(19, 31),//图标大小
                            imageSize:new AMap.Size(19, 31),
                            image: "//webapi.amap.com/theme/v1.3/markers/b/end.png"
                        }),
                        offset: new AMap.Pixel(-9, -31)
                    },
                    midMarkerOptions : {//可缺省
                        icon: new AMap.Icon({
                            size: new AMap.Size(19, 31),//图标大小
                            imageSize:new AMap.Size(19, 31),
                            image: "//webapi.amap.com/theme/v1.3/markers/b/mid.png"
                        }),
                        offset: new AMap.Pixel(-9, -31)
                    },
                    lineOptions : {//可缺省
                        strokeStyle: "solid",
                        strokeColor: "#FF33FF",
                        strokeOpacity: 1,
                        strokeWeight: 2,
                    }
                });
                break;
            }
            case 'clear': {
                this.state.mouseTool.close(true);
                break;
            }
            case 'cursor': {
                this.state.mouseTool.close(false);
                break;
            }
            default: {
                break;
            }
        }
    }



    render() {
        let { map, satelliteLayer, defaultLayer } = this.state;
        const switchSatelliteLayer = () => {
            if (map) {
                if (!satelliteLayer)
                {
                    satelliteLayer = new window.AMap.TileLayer.Satellite();
                    this.setState({ satelliteLayer });
                }
                map.setLayers([satelliteLayer]);
            }
        };
        const switchMapLayer = () => {
            if (map) {
                if (!defaultLayer)
                {
                    defaultLayer = new window.AMap.TileLayer()//高德默认标准图层
                    this.setState({ defaultLayer });
                }
                map.setLayers([defaultLayer]);
            }
        };
        return (
            <React.Fragment>
                <div id = "amap" style={{width: "100%", height: "100%"}} />
                <div onClick={switchMapLayer} style={{...this.switchTypeStyle, backgroundImage: `url(${mapimg})`, right: "70px"}}>
                    <p style={this.textStyle}>地图</p>
                </div>
                <div onClick={switchSatelliteLayer} style={{...this.switchTypeStyle, backgroundImage: `url(${earth})`}}>
                    <p style={this.textStyle}>地球</p>
                </div>
                <div style={{position: "absolute", right: "70px", top: "10px",width: "200px", backgroundColor: "rgba(255,255,255,0.5)"}}>
                    <div className="btn-group me-2" role="group" aria-label="First group">
                        <button type="button" className="btn btn-outline-secondary" onClick={() => this.draw('cursor')} title={"拖动"}>
                            <svg className="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
                                <path
                                    d="M352 32c57.438 0 112 46.562 112 104l-0.002 143.971C476.312 274.836 489.825 272 504 272c32.167 0 60.923 14.604 80 37.543C603.077 286.603 631.833 272 664 272c38.095 0 71.407 20.483 89.522 51.036C771.366 311.016 792.864 304 816 304c54.217 0 99.436 38.524 109.778 89.691 0.165 0.25 0.32 0.563 0.467 0.942l0.123 0.34 0.119 0.37c0.058 0.194 0.115 0.4 0.17 0.617l0.107 0.45 0.103 0.481 0.05 0.253 0.096 0.529 0.092 0.56 0.088 0.591 0.083 0.624 0.115 0.993 0.072 0.702 0.067 0.734c0.313 9.287 0.47 13.994 0.47 14.123l-82.038 496.632C837.888 958.53 798.016 992 751.414 992H352a96 96 0 0 1-83.153-48.025L78.634 574.07C49.915 524.33 66.958 460.723 116.7 432.005l13.856-8c35.308-20.385 77.6-17.714 109.442 3.342L240 136c0-57.438 46.562-104 104-104h8z m0 64c-26.245 0-47.57 21.063-47.994 47.206L304 144v380.99c0 17.673-14.328 32-32 32a32 32 0 0 1-27.713-16L221.198 501c-13.255-22.959-42.611-30.825-65.57-17.57-22.728 13.123-30.664 42.026-17.96 64.879L324.133 911.73A32 32 0 0 0 352 928h404.892c15.643 0 28.993-11.31 31.565-26.74L864 416c0-26.51-21.49-48-48-48-26.245 0-47.57 21.063-47.994 47.206L768 416v80c0 17.673-14.327 32-32 32-17.496 0-31.713-14.042-31.996-31.47L704 496V376c0-22.091-17.909-40-40-40-21.87 0-39.641 17.552-39.995 39.339L624 376v120c0 17.673-14.327 32-32 32-17.496 0-31.713-14.042-31.996-31.47L560 496V384c0-26.51-21.49-48-48-48-26.245 0-47.57 21.063-47.994 47.206L464 384v112c0 17.673-14.327 32-32 32-17.496 0-31.713-14.042-31.996-31.47L400 496V144c0-26.51-21.49-48-48-48z"
                                    fill="#13227a"/>
                            </svg>
                        </button>
                        <button type="button" className="btn btn-outline-secondary" onClick={() => this.draw('rule')} title={"测距"}>
                            <svg t="1687859556249" className="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
                                <path
                                    d="M929.19 352.19c3.12 3.12 3.12 8.19 0 11.31L363.51 929.19c-3.12 3.12-8.19 3.12-11.31 0L94.81 671.81c-3.12-3.12-3.12-8.19 0-11.31L660.49 94.81c3.12-3.12 8.19-3.12 11.31 0l257.39 257.38z m-424.26 5.66l108.89 108.89c3.12 3.12 3.12 8.19 0 11.31l-36.77 36.77c-3.12 3.12-8.19 3.12-11.31 0L456.85 405.93l-50.91 50.91 62.23 62.23c3.12 3.12 3.12 8.19 0 11.31l-36.77 36.77c-3.12 3.12-8.19 3.12-11.31 0l-62.23-62.23-50.91 50.91 62.23 62.23c3.12 3.12 3.12 8.19 0 11.31l-36.77 36.77c-3.12 3.12-8.19 3.12-11.31 0l-62.23-62.23-62.23 62.23 161.22 161.22 469.52-469.52-161.23-161.21-62.23 62.23 62.23 62.23c3.12 3.12 3.12 8.19 0 11.31l-36.77 36.77c-3.12 3.12-8.19 3.12-11.31 0l-62.23-62.23-50.91 50.91z"
                                    fill="#13227a" />
                            </svg>
                        </button>
                        <button type="button" className="btn btn-outline-secondary" onClick={() => this.draw('measureArea')} title={"面积量算"}>
                            <svg t="1687859675889" className="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
                                <path
                                    d="M860.4 743.2V289.7c40.3-12.8 69.6-50.5 69.6-94.9 0-54.9-44.7-99.6-99.6-99.6-44.4 0-82.2 29.3-94.9 69.6H291.2c-12.8-40.3-50.5-69.6-94.9-69.6-54.9 0-99.6 44.7-99.6 99.6 0 44.4 29.3 82.2 69.6 94.9v453.5c-40.3 12.8-69.6 50.5-69.6 95 0 54.9 44.7 99.6 99.6 99.6 44.4 0 82.2-29.3 94.9-69.6h444.2c12.8 40.3 50.5 69.6 94.9 69.6 54.9 0 99.6-44.7 99.6-99.6 0.1-44.5-29.2-82.2-69.5-95z m-634.1 0V526.5l301.8-301.8h207.4c1.9 6 4.3 11.7 7.2 17.1L237.2 747.4c-3.5-1.6-7.2-3-10.9-4.2z m55.7 44.3l503.8-503.8c4.7 2.4 9.6 4.4 14.7 6v211.1L493 808.2H291.2c-2.3-7.3-5.4-14.3-9.2-20.7z m548.4-632.3c21.8 0 39.6 17.7 39.6 39.6s-17.7 39.6-39.6 39.6-39.6-17.7-39.6-39.6 17.8-39.6 39.6-39.6z m-539.2 69.5h152L226.3 441.6v-152c30.8-9.7 55.2-34.1 64.9-64.9z m-94.9-69.5c21.8 0 39.6 17.7 39.6 39.6s-17.7 39.6-39.6 39.6c-21.8 0-39.6-17.7-39.6-39.6s17.8-39.6 39.6-39.6z m0 722.5c-21.8 0-39.6-17.7-39.6-39.6s17.7-39.6 39.6-39.6c21.8 0 39.6 17.7 39.6 39.6s-17.8 39.6-39.6 39.6z m539.2-69.5H577.9l222.5-222.5v157.6c-30.8 9.7-55.2 34-64.9 64.9z m94.9 69.5c-21.8 0-39.6-17.7-39.6-39.6s17.7-39.6 39.6-39.6 39.6 17.7 39.6 39.6-17.8 39.6-39.6 39.6z"
                                    fill="#13227a" />
                            </svg>
                        </button>
                        <button type="button" className="btn btn-outline-secondary" onClick={() => this.draw('clear')} title={"清除"}>
                            <svg className="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
                                <path
                                    d="M931.254875 57.813615c-4.076844-18.94136-14.709997-32.820434-31.030675-42.531591-11.378119-6.771204-24.007739-13.148435-42.135572-12.215182-8.710365 0.883111-19.250398 5.087868-27.629212 10.233042-16.525339 10.149131-30.115841 25.955087-42.693273 42.809929-20.654371 26.661166-35.450326 54.685374-51.962362 83.568134-31.45023 54.839893-62.973114 108.966543-87.492505 172.42675-13.492265 34.472047-40.336603 129.225918 5.116521 147.86745 11.10592 4.554727 24.499948 1.792829 34.280689-2.55826 24.880617-10.251461 47.747372-32.72629 61.909901-48.095295 17.362402-18.560691 32.415206-39.03189 47.071991-59.863293 23.339521-33.169381 42.297254-69.926466 62.421553-104.888676 24.264588-41.538985 46.766023-79.527106 64.468162-124.331455C932.130823 98.476652 935.315346 76.672087 931.254875 57.813615M541.12426 509.161354c55.734261 34.313435 150.242539 89.510461 150.242539 89.510461s15.780373 9.69683 22.947596 10.702738c9.843163 1.315969 20.723956-2.750642 27.629212-12.27965 1.074469-2.029212 2.67901-3.994979 3.774969-5.906512 12.194716-21.246864 24.322916-35.663173 16.179462-53.956781-4.523004-10.315929-12.402446-14.960707-22.296774-20.664604-8.994844-5.185082-19.28519-11.054755-26.821825-15.662693-39.562985-23.532926-79.139273-47.074038-118.703282-70.607987-7.770972-4.381788-16.611296-10.061126-25.070952-15.349562-4.140289-2.587936-8.473982-5.02954-12.434169-7.305368-6.122429-2.525515-11.930703-4.109589-18.264956-3.950977-5.820554 0.621146-11.240996 3.075029-16.372866 7.163129-5.659895 5.233177-8.655107 11.759811-12.27965 17.907823-10.984147 18.037782-22.373522 34.976536-8.186433 54.23512C509.017068 491.974961 519.209178 495.669089 541.12426 509.161354M769.267874 691.056737c-14.01415-19.128625-33.611448-28.528696-57.000088-42.283951-55.593045-33.083423-111.204509-66.17708-166.798577-99.260503-25.730983-15.746604-49.464476-29.898901-72.516449-43.592757-26.663213-16.426078-61.60291-22.852428-110.143343-21.898709-7.843626 0.682544-15.691346 1.365088-23.535996 2.046608-21.665396 3.745293-39.86179 7.092521-54.23512 18.931127-11.155039 9.01531-19.406963 24.416037-28.140864 37.350602-14.375377 23.145093-30.894576 41.692481-53.211816 54.746772-11.231786 6.571659-25.241844 10.407003-39.908862 13.302954-5.456258 0.511652-10.39984 1.06833-15.861214 1.534956-14.570828 3.409649-36.518655 19.077459-47.583643 34.792341-4.870928 7.13857-7.815997 14.187089-9.209737 22.001039-1.257641 14.418356 6.545053 21.605021 18.931127 28.652516 8.229412 4.988608 17.632554 10.004845 23.024343 13.302954 19.099972 11.426214 37.18278 22.343846 56.281728 33.769037 11.839629 2.628868 22.859591-3.724827 30.187473-7.163129 17.843355-8.030891 32.571771-18.555574 47.583643-28.652516 7.163129-5.286389 14.327281-10.063173 21.489387-15.349562-16.037223 26.433993-54.160419 105.146548-40.420514 147.355798 7.516169 24.708702 33.449766 31.700939 55.258424 46.048687 24.216493 14.325235 48.439125 28.654563 72.654595 42.978774 9.425655 1.670032 22.721445 0.401135 38.373906-0.511652 21.899732-1.678219 49.728489-3.63887 73.166247-7.163129-6.159268 11.652364-22.302914 36.468513-15.349562 59.351641 5.018284 12.266347 19.078483 16.26542 31.210777 21.489387 33.790526 14.549338 85.387568 27.780661 128.936323 8.698085 33.285014-14.393796 47.59183-42.275764 63.95651-72.654595 18.930104-33.764944 37.8643-67.541144 56.793381-101.307111 13.958892-25.8415 28.674006-45.442891 34.280689-72.142943 1.330295-14.119551 0.795107-26.374641-1.534956-36.327297C781.949682 711.991494 776.31537 700.675796 769.267874 691.056737"
                                    fill="#13227a"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </React.Fragment>
        );
    }

    switchTypeStyle = {
        position: "absolute",
        right: "10px",
        bottom: "10px",
        cursor: "pointer",
        width: "50px",
        height: "50px",
        backgroundSize: "contain", // 添加 backgroundSize 属性
        backgroundRepeat: "no-repeat", // 可选：禁止背景图像重复
        color: "white",
        fontSize: "10px",
        border: "1px solid black", // 添加边框样式
    }

    textStyle = {
        position: "absolute",
        backgroundColor: "#3385FF",
        margin: "0",
        bottom: "0",
        right: "0",
    };

    chooseBtn = {
        // position: "absolute",
        display: "inline-block",
        width: "30px",
        height: "30px",
        backgroundColor: "#f3f6f8",
    }
}

export default Measure;